<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Movie Recommender Chatbot</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:24px}
    #messages{border:1px solid #ddd;padding:12px;height:320px;overflow:auto;background:#f9f9f9}
    .user{color:#0b69ff}
    .bot{color:#333}
    .msg{margin:8px 0}
    #controls{margin-top:12px}
  </style>
</head>
<body>
  <h1>Movie Recommender Chatbot</h1>
  <div id="messages"></div>
  <div id="controls">
    <input id="input" placeholder="Ask for recommendations or chat..." style="width:70%" />
    <button id="send">Send</button>
  </div>

  <script>
    const messages = document.getElementById('messages');
    const input = document.getElementById('input');
    const send = document.getElementById('send');

    function append(kind, text){
      const d = document.createElement('div');
      d.className = 'msg ' + (kind==='user' ? 'user' : 'bot');
      d.textContent = (kind==='user' ? 'You: ' : 'Bot: ') + text;
      messages.appendChild(d);
      messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage(){
      const text = input.value.trim();
      if(!text) return;
      append('user', text);
      input.value = '';

      // call chat endpoint
      try{
        const res = await fetch('/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({message: text})
        });
        if(!res.ok){
          const err = await res.json();
          append('bot', 'Error: ' + (err.detail || res.statusText));
          return;
        }
        const data = await res.json();
        if(data.reply_type === 'recommendations'){
          if(data.results.length === 0){
            append('bot', 'No recommendations found.');
          } else {
            const lines = data.results.map((r,i)=>`${i+1}. ${r.title} (${r.genres}) â€” ${r.score.toFixed(3)}`);
            append('bot', lines.join('\n'));
          }
        } else if(data.reply_type === 'echo'){
          append('bot', data.message);
        } else {
          append('bot', JSON.stringify(data));
        }
      }catch(e){
        append('bot', 'Request failed: ' + e.message);
      }
    }

    send.addEventListener('click', sendMessage);
    input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') sendMessage(); });
  </script>
</body>
</html>